# HTTPS 详解

## 一、基础概念

### 1. 定义
- HTTPS（HyperText Transfer Protocol Secure）是 HTTP 的安全版本
- 通过 SSL/TLS 协议对数据进行加密和身份验证

### 2. 核心目的
- 防止数据在传输中被窃听（加密）
- 防止数据被篡改（完整性校验）
- 防止冒充（身份认证）

## 二、HTTPS 与 HTTP 的核心区别

### 1. 加密
- HTTPS：使用 TLS/SSL 加密
- HTTP：明文传输

### 2. 端口
- HTTP：默认 80
- HTTPS：默认 443

### 3. 证书
- HTTPS：需要 CA 签发的 SSL 证书，用于验证服务器身份
- HTTP：无需证书

### 4. 性能
- HTTPS：因加密略慢，但现代优化（如 TLS 1.3）已大幅减少开销
- HTTP：性能略优

## 三、核心工作原理

### 1. 加密机制
#### 混合加密体系
1. **非对称加密**（如 RSA、ECDHE）
   - 用于握手阶段交换密钥
   - 优点：安全，无需提前共享密钥
   - 缺点：计算量大，速度慢

2. **对称加密**（如 AES、ChaCha20）
   - 用于数据传输
   - 优点：速度快，适合大量数据

### 2. TLS 握手流程（以 RSA 为例）
1. **ClientHello**
   - 客户端发送支持的 TLS 版本
   - 发送加密套件
   - 发送随机数（Client Random）

2. **ServerHello**
   - 服务器返回选定的加密套件
   - 返回随机数（Server Random）
   - 返回证书

3. **证书验证**
   - 客户端验证证书
   - 检查 CA 信任链
   - 检查有效期
   - 检查域名匹配

4. **密钥交换**
   - 客户端生成预主密钥（Pre-Master Secret）
   - 用服务器公钥加密后发送

5. **生成会话密钥**
   - 双方用 Client Random、Server Random 和 Pre-Master Secret 生成主密钥
   - 派发生成对称密钥

6. **加密通信**
   - 后续数据使用对称密钥加密传输

> 注：TLS 1.3 简化握手至 1-RTT（一轮往返），提升速度

## 四、证书与身份验证

### 1. SSL 证书
- 由 CA（证书颁发机构）签发
- 包含公钥、域名、有效期等信息

### 2. 验证过程
- 检查证书是否由受信 CA 签发
- 确保证书未过期且域名匹配
- 通过 OCSP 或 CRL 检查证书是否被吊销

## 五、扩展要点

### 1. 前向保密（Forward Secrecy）
- 使用临时密钥（如 ECDHE）
- 即使服务器私钥泄露，历史会话仍安全

### 2. HSTS
- 强制客户端使用 HTTPS
- 防止降级攻击

### 3. SEO 影响
- 搜索引擎优先索引 HTTPS 网站

### 4. 常见攻击防御
- 防中间人攻击（依赖证书验证）
- 防窃听（加密）

## 六、总结

### 1. 核心要点
HTTPS 通过 TLS/SSL 协议实现安全通信，核心包括：
- 加密（混合加密体系）
- 身份验证（CA 证书）
- 完整性校验（如 HMAC）

### 2. 记忆技巧
- **类比**：HTTPS 像寄送保险箱，先非对称加密"寄送钥匙"，后用对称加密"装货物"
- **流程口诀**：Hello→证书→传密钥→加密通信
- **核心三点**：加密、证书、完整性