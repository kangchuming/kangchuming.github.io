# Vue Diff 算法详解

## 一、Diff 算法的作用
- 当数据变化时，Vue 生成新的虚拟 DOM 树
- 通过 diff 算法对比新旧树的差异
- 找出最小修改量，避免全量更新 DOM
- 提升性能

## 二、核心思想

### 1. 同层比较
- 仅比较同一层级的节点
- 不跨层级（如父节点不同则直接替换整个子树）

### 2. 双端对比
- 从新旧子节点的两端向中间同时对比
- 使用四个指针：旧前、旧后、新前、新后
- 快速找到可复用的节点

### 3. 节点复用
- 若节点相同（标签和 key 一致）
- 则复用真实 DOM
- 仅更新属性或子节点

## 三、具体步骤

### 1. 跳过静态内容
- 静态节点（无动态绑定的元素）会被跳过比较
- 直接复用

### 2. 双端比较四步走
通过四个指针依次比较以下情况：

1. **旧前 vs 新前**
   - 若相同，复用节点
   - 指针后移

2. **旧后 vs 新后**
   - 若相同，复用节点
   - 指针前移

3. **旧前 vs 新后**
   - 若相同，复用节点
   - 将旧节点移动到旧后之后
   - 指针移动

4. **旧后 vs 新前**
   - 若相同，复用节点
   - 将旧节点移动到旧前之前
   - 指针移动

### 3. Key 的查找
- 若四步均未匹配，则用新节点的 key 在旧节点中查找：
  - 找到则移动节点到正确位置
  - 找不到则创建新节点

### 4. 清理多余节点
- 循环结束后
- 删除旧节点中未匹配的节点
- 创建新节点中剩余的节点

## 四、Key 的作用

### 1. 唯一标识
- Key 帮助 Vue 识别节点身份
- 在列表更新时精准定位可复用的节点

### 2. 避免问题
无 key 或使用 index 作为 key 可能导致：
- 错误复用节点（如列表顺序变化时状态错乱）
- 不必要的 DOM 操作（如删除重建而非移动）

